## âœ¨ç®€ä»‹

**OlaIndex**ä¸€æ¬¾ `OneDrive` ç›®å½•æ–‡ä»¶ç´¢å¼•åº”ç”¨ï¼ŒåŸºäºä¼˜é›…çš„ `PHP` æ¡†æ¶ `Laravel` æ­å»ºï¼Œå¹¶é€šè¿‡ `Microsoft Graph` æ¥å£è·å–æ•°æ®å±•ç¤ºï¼Œæ”¯æŒå¤šç±»å‹å¸å·ç™»å½•ï¼Œå¤šç§ä¸»é¢˜æ˜¾ç¤ºï¼Œç®€å•è€Œå¼ºå¤§ã€‚

- **é¡¹ç›®åœ°å€ï¼š**https://github.com/WangNingkai/OLAINDEX

- **æ–‡æ¡£åœ°å€ï¼š**https://olaindex.js.org

- **æ¼”ç¤ºåœ°å€ï¼š**https://ola.niege.ml

## âš™ï¸åŠŸèƒ½

> OneDrive æ–‡ä»¶ç›®å½•ç´¢å¼•
>
> æ”¯æŒå¤šç§èµ„æºå³æ—¶é¢„è§ˆ
>
> æ”¯æŒå¤šè´¦å·

## ğŸ’–å®‰è£…

æœ¬ç¨‹åºå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼Œä¹Ÿå¯ä½¿ç”¨dockerå®‰è£…ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸‹ä½¿ç”¨å®å¡”é¢æ¿ä¸‹æ‰‹åŠ¨å®‰è£…çš„æ–¹æ³•ã€‚

### âš—ï¸ç¯å¢ƒå‡†å¤‡

1. å®å¡”é¢æ¿ï¼ˆå®å¡”æœåŠ¡å™¨é¢æ¿ï¼Œä¸€é”®å…¨èƒ½éƒ¨ç½²åŠç®¡ç†ï¼Œé€ä½ 3188å…ƒç¤¼åŒ…ï¼Œç‚¹æˆ‘é¢†å–https://www.bt.cn/?invite_code=MV9mbmFramU=ï¼‰
2. åœ¨å®å¡”é¢æ¿å®‰è£…nginx+mysql+PHP7.0ä»¥ä¸Šï¼Œå¹¶å¯åŠ¨æˆåŠŸ
3. åŸŸåä¸€ä¸ªï¼ˆä»»æ„åŸŸåï¼‰

### ğŸ‰å®‰è£…PHPæ‰©å±•

?> å®å¡”é¢æ¿ - PHPè®¾ç½® - å®‰è£… - å®‰è£…æ‰©å±•

- å®‰è£…`fileinfo` ï¼ˆå¿…é¡»ï¼‰
- å®‰è£… `opcache`  ï¼ˆå¯é€‰ã€åŠ é€Ÿphpè¿è¡Œï¼‰
- å®‰è£… `redis` ï¼ˆå¯é€‰ï¼‰

![image-20210809012324024](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210809012324024.png)

!> å®‰è£…`fileinfo`æœ‰æ—¶ä¼šå‡ºé”™ï¼Œå°¤å…¶æ˜¯å°å†…å­˜çš„æœºå™¨ï¼Œå¯ä»¥å»å®å¡”å·¥å…·ç®±è®¾ç½®ä¸€ä¸‹swapï¼Œç„¶åæŠŠnginxå’Œmysqlæš‚æ—¶å…ˆå…³é—­ï¼Œå®‰è£…åå†å¼€å¯ã€‚

### ğŸç¦ç”¨å‡½æ•°

?> å®å¡”é¢æ¿ - PHPè®¾ç½® - å®‰è£… - ç¦ç”¨å‡½æ•° - å‡½æ•° - åˆ é™¤

å…³é—­ä¸‹åˆ—å‡ ä¸ªç¦ç”¨çš„å‡½æ•°

-  `exec` 
- `shell_exec` 
-  `proc_open` 
- `putenv``
- ``proc_get_status`(è¿™ä¸ªæœ‰å¯èƒ½æ²¡æœ‰) 

![image-20210809014257767](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210809014257767.png)

ç¦ç”¨å®Œäº†ä¹‹åï¼Œè®°å¾—é‡å¯ä¸€ä¸‹`php`æœåŠ¡ã€‚

### ğŸµå®‰è£…Composer

å®å¡”é¢æ¿å·²ç»é»˜è®¤è‡ªå¸¦äº†ï¼Œä½†æ˜¯ä¸ºé¿å…å‡ºé”™ï¼Œæˆ‘ä»¬è¿›è¡Œé¥±å’Œå¼è®¾ç½®ã€‚
æ¥ä¸‹æ¥ç”¨sshï¼ˆä¸å»ºè®®ç›´æ¥å®å¡”çš„sshï¼Œè¿™é‡Œç”¨çš„æ˜¯FinalShellï¼‰ã€‚

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344703362-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344703362-image.png)

```nginx
curl -sS https://getcomposer.org/installer | php
mv composer.phar /usr/local/bin/composer
composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ # æ›´æ¢æºä¸ºå›½å†…æºï¼Œå›½å¤–æœåŠ¡å™¨å¯å¿½ç•¥æ­¤æ­¥éª¤curl -sS https://getcomposer.org/installer | php
```

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344733927-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344733927-image.png)

æ³¨ï¼šåœ¨æ‰§è¡Œç¬¬ä¸‰è¡Œä»£ç æ—¶ï¼Œå¦‚æœå‡ºç°è®©ä½ ä¸è¦ç”¨`root`æ¥æ“ä½œçš„é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„æ­¥éª¤ã€‚

æ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼ˆDebianä¸ºä¾‹ï¼‰:

```nginx
adduser roy
```

æ‰§è¡Œå‘½ä»¤åï¼Œæ ¹æ®æç¤ºæ“ä½œå³å¯ã€‚è¯·åŠ¡å¿…è®¾ç½®ä¸€ä¸ªç”¨æˆ·å¯†ç ï¼ˆåˆ«å¿˜è®°è®¾ç½®å¯†ç æ—¶ä½ æ—¶çœ‹ä¸åˆ° ****** çš„ï¼‰ã€‚ä¹‹åç³»ç»Ÿä¼šè¯¢é—®ä½ ä¸€äº›ç”¨æˆ·çš„é™„åŠ ä¿¡æ¯ï¼Œè¿™äº›å°±å¯ä»¥æ— è§†ï¼Œä¸€è·¯å›è½¦å³å¯ã€‚

å®‰è£…sudoåŠŸèƒ½:

sudo å°±æ˜¯åœ¨å…³é”®æ—¶åˆ»ï¼Œè®©æ™®é€šè´¦æˆ·ä¸´æ—¶è·å¾— root çš„ç¥åŠ›ï¼Œæˆ˜åŠ›å…¨å¼€æ‹¯æ•‘ä¸–ç•Œã€‚

```sql
apt update && apt install sudo
```

èªæ˜çš„ä½ å¤§æ¦‚å·²ç»å‘ç°ï¼Œè¿™ä¸€è¡Œå‘½ä»¤å…¶å®æ˜¯ä¸¤ä¸ªå‘½ä»¤ã€‚å‰ä¸€åŠ `apt update` ä½ ä¹‹å‰å·²ç»è§è¿‡å¹¶ä¸”ç”¨è¿‡äº†ï¼Œæ˜¯å»æœåŠ¡å™¨åˆ·æ–°è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ã€‚åé¢çš„ `apt install` å°±æ˜¯è¿™ä¸€æ¬¡è¦ç”¨åˆ°çš„ã€å®‰è£…å‘½ä»¤ã€‘ã€‚ä¸¤æ¡è¿æ¥åœ¨ä¸€èµ·ï¼Œå°±æ˜¯è®©ç³»ç»Ÿå»ã€åˆ·æ–°å¯ç”¨çš„æœ€æ–°è½¯ä»¶ï¼Œç„¶åå®‰è£…æœ€æ–°ç‰ˆçš„sudoç¨‹åºã€‘ã€‚ `&&` åˆ™æ˜¯æŠŠä¸¤ä¸ªå‘½ä»¤è¿èµ·æ¥æ‰§è¡Œçš„æ„æ€ã€‚

æŠŠ`roy`ç”¨æˆ·åŠ å…¥`sudo`åå•é‡Œï¼Œè®©ä»–æœ‰èµ„æ ¼å€Ÿç”¨`root`çš„ç¥åŠ›:

```nginx
visudo
```

åœ¨ `User Privilege Specification` ä¸‹åŠ å…¥ä¸€è¡Œ `roy ALL=(ALL) NOPASSWD: ALL` å³å¯ã€‚

> æ³¨æ„ï¼šè¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯`NOPASSWD`è¿™ä¸ªè®¾ç½®ï¼Œå®ƒçš„æ„æ€æ˜¯`roy`ç”¨æˆ·ä¸´æ—¶ä½¿ç”¨`root`æƒé™æ—¶ï¼Œä¸ç”¨é¢å¤–è¾“å…¥å¯†ç ã€‚è¿™ä¸ä¸€èˆ¬çš„å®‰å…¨å»ºè®®ç›¸åã€‚æˆ‘ä¹‹æ‰€ä»¥å¦‚æ­¤æ¨èï¼Œæ˜¯å› ä¸ºå¾ˆå¤šæ–°äººä¸é¡¾å±é™©åšæŒä½¿ç”¨`root`è´¦å·å°±æ˜¯å› ä¸ºç”¨`root`æ—¶ä¸ç”¨é‡å¤è¾“å…¥å¯†ç ã€è§‰å¾—è½»æ¾ã€‚â€œä¸¤å®³ç›¸æƒå–å…¶è½»â€ï¼Œæˆ‘è®¤ä¸ºã€ç›´æ¥ç”¨`root`ç”¨æˆ·çš„é£é™©ã€‘å¤§äºã€ä½¿ç”¨`sudo`æ—¶ä¸ç”¨è¾“å¯†ç çš„é£é™©ã€‘ï¼Œæ‰€ä»¥åšäº†ä»¥ä¸Šçš„å»ºè®®ã€‚
>
> å¦‚æœä½ å¸Œæœ›éµå®ˆä¼ ç»Ÿä¹ æƒ¯ã€æ¯æ¬¡ä½¿ç”¨`sudo`æ—¶éœ€è¦è¾“å…¥å¯†ç ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œæ”¹æˆ `vpsadmin ALL=(ALL:ALL) ALL` å³å¯ã€‚

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344748923-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344748923-image.png)

### ğŸš€æ–°å»ºç«™ç‚¹

å®å¡”é¢æ¿å†…ï¼Œæ–°å»ºä¸€ä¸ªç«™ç‚¹ï¼ŒPHPç‰ˆæœ¬å°±é€‰åˆšæ‰é…ç½®çš„å¯¹åº”ç‰ˆæœ¬ï¼Œæ•°æ®åº“ä¸ç”¨åˆ›å»ºï¼Œåˆ é™¤ç«™ç‚¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚

![image-20210809020205877](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210809020205877.png)

![image-20210809020403825](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210809020403825.png)

## é…ç½®OLAINDEX

æ³¨æ„ï¼šè¿™äº›å‘½ä»¤è¦ä¸€è¡Œä¸€è¡Œæ‰§è¡Œï¼

```perl
cd webç›®å½•   #ä¾‹å¦‚æˆ‘æ˜¯cd /www/wwwroot/od.laoda.de
sudo git clone https://github.com/WangNingkai/OLAINDEX.git tmp #ä»githubä»“åº“æ‹‰å–é¡¹ç›®ä»£ç 
sudo mv tmp/.git .   #è¿›è¡Œæ•´ç†
sudo rm -rf tmp     #åˆ é™¤ç¼“å­˜æ–‡ä»¶
sudo git reset --hard 
sudo composer install -vvv # è¿™é‡Œç¡®ä¿å·²æˆåŠŸå®‰è£… composer ï¼Œå¦‚æœæŠ¥æƒé™é—®é¢˜ï¼Œå»ºè®®ç»™äºˆç”¨æˆ·å®Œæ•´æƒé™ã€‚ç›´æ¥ç”¨rootè¿è¡Œã€‚
sudo chmod -R 777 storage/* 
sudo chown -R www:www * # æ­¤å¤„ www æ ¹æ®æœåŠ¡å™¨å…·ä½“ç”¨æˆ·ç»„è€Œå®šï¼Œå¦‚æœæ˜¯å®å¡”ï¼Œç›´æ¥è¿è¡Œå°±å¯ä»¥
composer run install-app # (æ­¤ä¸ºè‡ªåŠ¨å®‰è£…ï¼Œé»˜è®¤sqliteå­˜å‚¨æ•°æ®)
```

æ³¨æ„è¿è¡Œ`composer install -vvv`çš„æ—¶å€™ï¼Œç”¨`root`æˆ–è€…`sudo`è¿è¡Œ,å¦åˆ™ä¼šæŠ¥é”™

```
vendor does not exist and could not be created
```

æ²¡æœ‰é‡åˆ°å…¶ä»–é—®é¢˜çš„è¯ï¼Œæœ€åç»“æœæ˜¯è¿™æ ·çš„ï¼Œé»˜è®¤è´¦æˆ·`admin`,é»˜è®¤å¯†ç `123456`

## é…ç½®ç½‘ç«™

### é…ç½®SSL

é€‰æ‹© Letâ€™s Encrypt ç”³è¯·ï¼ŒæŒ‰è¦æ±‚å¡«å†™ç”³è¯·ï¼Œ

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344849693-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344849693-image.png)

å¼€å¯ SSL åï¼Œé€‰æ‹©å¼ºåˆ¶ HTTPS

### ç½‘å€è¿è¡Œç›®å½•

å¦‚å›¾ï¼šå‹¾é€‰å–æ¶ˆ é˜²è·¨ç«™æ”»å‡»(open_basedir) å°†ç«™ç‚¹çš„è¿è¡Œç›®å½•æ”¹ä¸º public åˆ«å¿˜äº†ä¿å­˜

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344863450-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344863450-image.png)

### ä¿®æ”¹ä¼ªé™æ€

é€‰æ‹© `Laravel 5`ï¼Œä¿å­˜

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344875529-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344875529-image.png)

### ä¿®æ”¹é…ç½®æ–‡ä»¶

æ³¨é‡Šé€‰å®šå†…å®¹ï¼Œé˜²æ­¢å›¾ç‰‡å‡ºç°404

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344889461-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344889461-image.png)

### ç™»é™†

è¾“å…¥ç½‘å€/adminï¼Œç™»é™†å°±OKå•¦ã€‚

#### åå°è®¾ç½®

è®°å¾—åœ¨è¿™è¾¹è®¾ç½®ä¸€ä¸‹ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™ã€‚

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-30/1619795722055-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-30/1619795722055-image.png)

#### å…·ä½“å¦‚ä¸‹

å›¾ç‰‡

```nginx
bmp jpg jpeg png gif
```

è§†é¢‘

```apache
mkv mp4 webm qlv TS
```

Dashè§†é¢‘

```nginx
avi mpg mpeg rm rmvb mov wmv asf ts flv TS
```

éŸ³é¢‘

```nginx
mp3 ogg wav flac ape
```

Officeæ–‡æ¡£

```nginx
text json md
```

ä»£ç 

```go
html htm css go java js ts sh php py
```

æ–‡ä»¶æµ

```bash
txt log
```

#### å…³äºå¯†ç æ–‡ä»¶å¤¹çš„é—®é¢˜

æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶**è¦**åŠ `/`

è§†é¢‘ä¸­è®¾ç½®äº†å¯†ç ä½†æ˜¯è¾“å…¥ä»ç„¶æ— æ•ˆï¼ŒçŒœæµ‹æ˜¯huxä¸»é¢˜çš„é—®é¢˜ï¼Œæˆ‘æ¢äº†simplexä¸»é¢˜åï¼Œbugæ¶ˆå¤±ï¼Œå…¶ä»–ä¸»é¢˜ä¹Ÿå¯ä»¥è¯•è¯•ã€‚

[![img](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344900239-image.png)](https://cdn.jsdelivr.net/gh/RalstonLiu/Mdnice3/2021-4-25/1619344900239-image.png)

#### å…³äºéšè—æ–‡ä»¶å¤¹çš„é—®é¢˜

æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶**ä¸è¦**åŠ `/`

ç»‘å®šå¥½ODè´¦æˆ·ï¼Œå°±å¯ä»¥æ„‰å¿«å¾—ç©è€èµ·æ¥äº†ã€‚

ODè´¦æˆ·ä¸ä¼šç»‘å®šï¼Ÿé¢ï¼Œè‡ªå·±å…ˆæŠ˜è…¾ä¸€ä¸‹ï¼Œä¸‹ä¸€ç¯‡å†å’Œå¤§å®¶ç»†è®²å§ã€‚

### å‚è€ƒ

[å®˜æ–¹æ–‡æ¡£](https://olaindex.js.org/#/install)

[å®å¡”é¢æ¿éƒ¨ç½²Olaindexæ­å»ºè‡ªæœ‰ç½‘ç›˜](https://lmqyu.cn/793.html)

[BT é¢æ¿å®‰è£… OLAINDEX å…¨æ–¹ä½æŒ‡å—](https://imwnk.cn/archives/bt-olaindex)

[Project X](https://xtls.github.io/documents/level-0/ch04-security/) ï¼ˆå‚è€ƒäº†æ·»åŠ ç”¨æˆ·çš„é‚£éƒ¨åˆ†å†…å®¹ï¼‰

[å§¨å¦ˆçº§å®‰è£…æ•™ç¨‹ï¼Olaindexâ€”â€”ä¸€æ¬¾é¢œå€¼è´¼é«˜çš„OneDriveç½‘ç›˜ç›´é“¾é¡¹ç›® - äºŒåäº”ç”»ç”Ÿ (laoda.de)](https://blog.laoda.de/archives/olaindex-install)

